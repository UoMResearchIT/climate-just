!function(e){var t;if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)t=require("leaflet"),module.exports=e(t);else{if(void 0===window.L)throw"Leaflet must be loaded first";e(window.L)}}(function(d){"use strict";function t(e){return r[e]}var o,n,r;return d.Control.Geocoder=d.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"click",position:"topleft",showUniqueResult:"true",iconLabel:"Search map",placeholder:"Search for a place...",errorMessage:"Nothing found."},_callbackId:0,initialize:function(e){d.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new d.Control.Geocoder.Nominatim)},onAdd:function(e){var t="leaflet-control-geocoder",o=d.DomUtil.create("div",t+" leaflet-bar"),n=d.DomUtil.create("a","leaflet-control-geocoder-icon",o),r=this._form=d.DomUtil.create("form",t+"-form",o);return n.innerHTML="&nbsp;",n.href="javascript:void(0);",this._map=e,this._container=o,(e=this._input=d.DomUtil.create("input")).type="text",e.placeholder=this.options.placeholder,d.DomEvent.addListener(e,"keydown",this._keydown,this),this._errorElement=document.createElement("div"),this._errorElement.className=t+"-form-no-error",this._errorElement.innerHTML=this.options.errorMessage,this._alts=d.DomUtil.create("ul",t+"-alternatives leaflet-control-geocoder-alternatives-minimized"),r.appendChild(e),this._container.appendChild(this._errorElement),o.appendChild(this._alts),d.DomEvent.addListener(r,"submit",this._geocode,this),this.options.collapsed?"click"===this.options.expand?d.DomEvent.addListener(n,"click",function(e){0===e.button&&2!==e.detail&&this._toggle()},this):(d.DomEvent.addListener(n,"mouseover",this._expand,this),d.DomEvent.addListener(n,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):this._expand(),d.DomEvent.disableClickPropagation(o),o},_geocodeResult:function(e){if(d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber"),1===e.length)this._geocodeResultSelected(e[0]);else if(0<e.length){this._alts.innerHTML="",this._results=e,d.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var t=0;t<e.length;t++)this._alts.appendChild(this._createAlt(e[t],t))}else d.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(e){return this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new d.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this},_geocode:function(e){return d.DomEvent.preventDefault(e),d.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber"),this._clearResults(),this.options.geocoder.geocode(this._input.value,this._geocodeResult,this),!1},_geocodeResultSelected:function(e){this.options.collapsed?this._collapse():this._clearResults(),this.markGeocode(e)},_toggle:function(){0<=this._container.className.indexOf("leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){d.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select()},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded",""),d.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),d.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_clearResults:function(){d.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,d.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAlt:function(t,e){function o(e){d.DomEvent.preventDefault(e),this._geocodeResultSelected(t)}var n=d.DomUtil.create("li"),r=d.DomUtil.create("a","",n),s=this.options.showResultIcons&&t.icon?d.DomUtil.create("imgs","",r):null,i=t.html?void 0:document.createTextNode(t.name);return s&&(s.src=t.icon),n.setAttribute("data-result-index",e),t.html?r.innerHTML=t.html:r.appendChild(i),d.DomEvent.addListener(r,"click",o,this),d.DomEvent.addListener(n,"click",o,this),n},_keydown:function(e){function t(e){n._selection&&(d.DomUtil.removeClass(n._selection,"leaflet-control-geocoder-selected"),n._selection=n._selection[0<e?"nextSibling":"previousSibling"]),n._selection||(n._selection=n._alts[0<e?"firstChild":"lastChild"]),n._selection&&d.DomUtil.addClass(n._selection,"leaflet-control-geocoder-selected")}var o,n=this;switch(e.keyCode){case 27:this.options.collapsed&&this._collapse();break;case 38:t(-1),d.DomEvent.preventDefault(e);break;case 40:t(1),d.DomEvent.preventDefault(e);break;case 13:this._selection&&(o=parseInt(this._selection.getAttribute("data-result-index"),10),this._geocodeResultSelected(this._results[o]),this._clearResults(),d.DomEvent.preventDefault(e))}return!0}}),d.Control.geocoder=function(e){return new d.Control.Geocoder(e)},d.Control.Geocoder.callbackId=0,d.Control.Geocoder.jsonp=function(e,t,o,n,r){var s="_l_geocoder_"+d.Control.Geocoder.callbackId++;t[r||"callback"]=s,window[s]=d.Util.bind(o,n);n=document.createElement("script");n.type="text/javascript",n.src=e+d.Util.getParamString(t),n.id=s,document.getElementsByTagName("head")[0].appendChild(n)},d.Control.Geocoder.getJSON=function(e,t,o){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&(200==n.status||304==n.status?o(JSON.parse(n.response)):o(""))},n.open("GET",e+d.Util.getParamString(t),!0),n.setRequestHeader("Accept","application/json"),n.send(null)},d.Control.Geocoder.template=function(e,o,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,t){t=o[t];return void 0===t?t="":"function"==typeof t&&(t=t(o)),d.Control.Geocoder.htmlEscape(t)})},d.Control.Geocoder.htmlEscape=(o=/[&<>"'`]/g,n=/[&<>"'`]/,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},function(e){return null==e?"":e?(e=""+e,n.test(e)?e.replace(o,t):e):e+""}),d.Control.Geocoder.Nominatim=d.Class.extend({options:{serviceUrl:"//nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(e){var t=e.address,e=[];return(t.road||t.building)&&e.push("{building} {road} {house_number}"),(t.city||t.town||t.village)&&e.push('<span class="'+(0<e.length?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village}</span>'),(t.state||t.country)&&e.push('<span class="'+(0<e.length?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),d.Control.Geocoder.template(e.join("<br/>"),t,!0)}},initialize:function(e){d.Util.setOptions(this,e)},geocode:function(e,s,i){d.Control.Geocoder.jsonp(this.options.serviceUrl+"search/",d.extend({q:e,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),function(e){for(var t=[],o=e.length-1;0<=o;o--){for(var n=e[o].boundingbox,r=0;r<4;r++)n[r]=parseFloat(n[r]);t[o]={icon:e[o].icon,name:e[o].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e[o]):void 0,bbox:d.latLngBounds([n[0],n[2]],[n[1],n[3]]),center:d.latLng(e[o].lat,e[o].lon),properties:e[o]}}s.call(i,t)},this,"json_callback")},reverse:function(e,t,n,r){d.Control.Geocoder.jsonp(this.options.serviceUrl+"reverse/",d.extend({lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),function(e){var t,o=[];e&&e.lat&&e.lon&&(t=d.latLng(e.lat,e.lon),o.push({name:e.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,center:t,bounds:d.latLngBounds(t,t),properties:e})),n.call(r,o)},this,"json_callback")}}),d.Control.Geocoder.nominatim=function(e){return new d.Control.Geocoder.Nominatim(e)},d.Control.Geocoder.Bing=d.Class.extend({initialize:function(e){this.key=e},geocode:function(e,s,i){d.Control.Geocoder.jsonp("//dev.virtualearth.net/REST/v1/Locations",{query:e,key:this.key},function(e){var t=[];if(0<e.resourceSets.length)for(var o=e.resourceSets[0].resources.length-1;0<=o;o--){var n=e.resourceSets[0].resources[o],r=n.bbox;t[o]={name:n.name,bbox:d.latLngBounds([r[0],r[1]],[r[2],r[3]]),center:d.latLng(n.point.coordinates)}}s.call(i,t)},this,"jsonp")},reverse:function(e,t,s,i){d.Control.Geocoder.jsonp("//dev.virtualearth.net/REST/v1/Locations/"+e.lat+","+e.lng,{key:this.key},function(e){for(var t=[],o=e.resourceSets[0].resources.length-1;0<=o;o--){var n=e.resourceSets[0].resources[o],r=n.bbox;t[o]={name:n.name,bbox:d.latLngBounds([r[0],r[1]],[r[2],r[3]]),center:d.latLng(n.point.coordinates)}}s.call(i,t)},this,"jsonp")}}),d.Control.Geocoder.bing=function(e){return new d.Control.Geocoder.Bing(e)},d.Control.Geocoder.RaveGeo=d.Class.extend({options:{querySuffix:"",deepSearch:!0,wordBased:!1},jsonp:function(e,t,o){var n,r="_l_geocoder_"+d.Control.Geocoder.callbackId++,s=[];for(n in e.prepend=r+"(",e.append=")",e)s.push(n+"="+escape(e[n]));window[r]=d.Util.bind(t,o);o=document.createElement("script");o.type="text/javascript",o.src=this._serviceUrl+"?"+s.join("&"),o.id=r,document.getElementsByTagName("head")[0].appendChild(o)},initialize:function(e,t,o){d.Util.setOptions(this,o),this._serviceUrl=e,this._scheme=t},geocode:function(e,s,i){d.Control.Geocoder.jsonp(this._serviceUrl,{address:e+this.options.querySuffix,scheme:this._scheme,outputFormat:"jsonp",deepSearch:this.options.deepSearch,wordBased:this.options.wordBased},function(e){for(var t=[],o=e.length-1;0<=o;o--){var n=e[o],r=d.latLng(n.y,n.x);t[o]={name:n.address,bbox:d.latLngBounds([r]),center:r}}s.call(i,t)},this)}}),d.Control.Geocoder.raveGeo=function(e,t,o){return new d.Control.Geocoder.RaveGeo(e,t,o)},d.Control.Geocoder.MapQuest=d.Class.extend({options:{serviceUrl:"//www.mapquestapi.com/geocoding/v1"},initialize:function(e,t){this._key=decodeURIComponent(e),d.Util.setOptions(this,t)},_formatName:function(){for(var e=[],t=0;t<arguments.length;t++)arguments[t]&&e.push(arguments[t]);return e.join(", ")},geocode:function(e,s,i){d.Control.Geocoder.jsonp(this.options.serviceUrl+"/address",{key:this._key,location:e,limit:5,outFormat:"json"},function(e){var t,o,n=[];if(e.results&&e.results[0].locations)for(var r=e.results[0].locations.length-1;0<=r;r--)t=e.results[0].locations[r],o=d.latLng(t.latLng),n[r]={name:this._formatName(t.street,t.adminArea4,t.adminArea3,t.adminArea1),bbox:d.latLngBounds(o,o),center:o};s.call(i,n)},this)},reverse:function(e,t,s,i){d.Control.Geocoder.jsonp(this.options.serviceUrl+"/reverse",{key:this._key,location:e.lat+","+e.lng,outputFormat:"json"},function(e){var t,o,n=[];if(e.results&&e.results[0].locations)for(var r=e.results[0].locations.length-1;0<=r;r--)t=e.results[0].locations[r],o=d.latLng(t.latLng),n[r]={name:this._formatName(t.street,t.adminArea4,t.adminArea3,t.adminArea1),bbox:d.latLngBounds(o,o),center:o};s.call(i,n)},this)}}),d.Control.Geocoder.mapQuest=function(e,t){return new d.Control.Geocoder.MapQuest(e,t)},d.Control.Geocoder.Mapbox=d.Class.extend({options:{service_url:"https://api.tiles.mapbox.com/v4/geocode/mapbox.places-v1/"},initialize:function(e){this._access_token=e},geocode:function(e,i,l){d.Control.Geocoder.getJSON(this.options.service_url+encodeURIComponent(e)+".json",{access_token:this._access_token},function(e){var t,o,n,r=[];if(e.features&&e.features.length)for(var s=0;s<=e.features.length-1;s++)t=e.features[s],o=d.latLng(t.center.reverse()),n=t.hasOwnProperty("bbox")?d.latLngBounds(d.latLng(t.bbox.slice(0,2).reverse()),d.latLng(t.bbox.slice(2,4).reverse())):d.latLngBounds(o,o),r[s]={name:t.place_name,bbox:n,center:o};i.call(l,r)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,i,l){d.Control.Geocoder.getJSON(this.options.service_url+encodeURIComponent(e.lng)+","+encodeURIComponent(e.lat)+".json",{access_token:this._access_token},function(e){var t,o,n,r=[];if(e.features&&e.features.length)for(var s=0;s<=e.features.length-1;s++)t=e.features[s],o=d.latLng(t.center.reverse()),n=t.hasOwnProperty("bbox")?d.latLngBounds(d.latLng(t.bbox.slice(0,2).reverse()),d.latLng(t.bbox.slice(2,4).reverse())):d.latLngBounds(o,o),r[s]={name:t.place_name,bbox:n,center:o};i.call(l,r)})}}),d.Control.Geocoder.mapbox=function(e){return new d.Control.Geocoder.Mapbox(e)},d.Control.Geocoder.What3Words=d.Class.extend({options:{serviceUrl:"http://api.what3words.com/"},initialize:function(e){this._accessToken=e},geocode:function(e,r,s){d.Control.Geocoder.getJSON(this.options.serviceUrl+"w3w",{key:this._accessToken,string:e.split(/\s+/).join(".")},function(e){var t,o,n=[];e.position&&e.position.length&&(t=e.words,o=d.latLng(e.position[0],e.position[1]),e=d.latLngBounds(o,o),n[0]={name:t.join("."),bbox:e,center:o}),r.call(s,n)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,r,s){d.Control.Geocoder.getJSON(this.options.serviceUrl+"position",{key:this._accessToken,position:[e.lat,e.lng].join(",")},function(e){var t,o,n=[];e.position&&e.position.length&&(t=e.words,o=d.latLng(e.position[0],e.position[1]),e=d.latLngBounds(o,o),n[0]={name:t.join("."),bbox:e,center:o}),r.call(s,n)})}}),d.Control.Geocoder.what3words=function(e){return new d.Control.Geocoder.What3Words(e)},d.Control.Geocoder.Google=d.Class.extend({options:{service_url:"https://maps.googleapis.com/maps/api/geocode/json"},initialize:function(e){this._key=e},geocode:function(e,i,l){e={address:e};this._key&&this._key.length&&(e.key=this._key),d.Control.Geocoder.getJSON(this.options.service_url,e,function(e){var t,o,n,r=[];if(e.results&&e.results.length)for(var s=0;s<=e.results.length-1;s++)t=e.results[s],o=d.latLng(t.geometry.location),n=d.latLngBounds(d.latLng(t.geometry.viewport.northeast),d.latLng(t.geometry.viewport.southwest)),r[s]={name:t.formatted_address,bbox:n,center:o};i.call(l,r)})},reverse:function(e,t,i,l){e={latlng:encodeURIComponent(e.lat)+","+encodeURIComponent(e.lng)};this._key&&this._key.length&&(e.key=this._key),d.Control.Geocoder.getJSON(this.options.service_url,e,function(e){var t,o,n,r=[];if(e.results&&e.results.length)for(var s=0;s<=e.results.length-1;s++)t=e.results[s],o=d.latLng(t.geometry.location),n=d.latLngBounds(d.latLng(t.geometry.viewport.northeast),d.latLng(t.geometry.viewport.southwest)),r[s]={name:t.formatted_address,bbox:n,center:o};i.call(l,r)})}}),d.Control.Geocoder.google=function(e){return new d.Control.Geocoder.Google(e)},d.Control.Geocoder.Photon=d.Class.extend({options:{serviceUrl:"//photon.komoot.de/api/"},initialize:function(e){d.setOptions(this,e)},geocode:function(e,i,l){e=d.extend({q:e},this.options.geocodingQueryParams);d.Control.Geocoder.getJSON(this.options.serviceUrl,e,function(e){var t,o,n,r,s=[];if(e&&e.features)for(t=0;t<e.features.length;t++)r=(o=e.features[t]).geometry.coordinates,n=d.latLng(r[1],r[0]),r=(r=o.properties.extent)?d.latLngBounds([r[1],r[0]],[r[3],r[2]]):d.latLngBounds(n,n),s.push({name:o.properties.name,center:n,bbox:r});i.call(l,s)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,o){t.call(o,[])}}),d.Control.Geocoder.photon=function(e){return new d.Control.Geocoder.Photon(e)},d.Control.Geocoder.OSOpenNames=d.Class.extend({options:{service_url:"https://api.os.uk/search/names/v1/"},initialize:function(e){this._key=e},geocode:function(e,l,a){e={query:e};this._key&&this._key.length&&(e.key=this._key);var c="+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.999601 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894 +datum=OSGB36 +units=m +no_defs";d.Control.Geocoder.getJSON(this.options.service_url+"find",e,function(e){var t,o=[];if(e.results&&e.results.length)for(var n=0;n<=e.results.length-1;n++){t=e.results[n];var r=d.latLng(proj4(c,"WGS84",[t.GAZETTEER_ENTRY.GEOMETRY_X,t.GAZETTEER_ENTRY.GEOMETRY_Y])),s=(d.latLng(proj4(c,"WGS84",[t.GAZETTEER_ENTRY.MBR_XMIN,t.GAZETTEER_ENTRY.MBR_YMIN])),d.latLng(proj4(c,"WGS84",[t.GAZETTEER_ENTRY.MBR_XMAX,t.GAZETTEER_ENTRY.MBR_YMAX])),d.latLng(r.lng,r.lat)),i=d.latLngBounds(s,s),r=t.GAZETTEER_ENTRY.NAME1+", ";t.GAZETTEER_ENTRY.DISTRICT_BOROUGH&&(r+=t.GAZETTEER_ENTRY.DISTRICT_BOROUGH+=", "),t.GAZETTEER_ENTRY.POPULATED_PLACE&&(r+=t.GAZETTEER_ENTRY.POPULATED_PLACE+=", "),t.GAZETTEER_ENTRY.COUNTY_UNITARY&&(r+=t.GAZETTEER_ENTRY.COUNTY_UNITARY+=", "),t.GAZETTEER_ENTRY.REGION&&(r+=t.GAZETTEER_ENTRY.REGION+=", "),t.GAZETTEER_ENTRY.COUNTRY&&(r+=t.GAZETTEER_ENTRY.COUNTRY),o[n]={name:r,bbox:i,center:s}}l.call(a,o)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,l,a){var e=[e.lng,e.lat],c="+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.999601 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894 +datum=OSGB36 +units=m +no_defs",e=d.latLng(proj4("WGS84",c,e)),e={point:encodeURIComponent(e.lat.toFixed(2))+","+encodeURIComponent(e.lng.toFixed(2))};this._key&&this._key.length&&(e.key=this._key),d.Control.Geocoder.getJSON(this.options.service_url+"nearest",e,function(e){var t,o=[];if(e.results&&e.results.length)for(var n=0;n<=e.results.length-1;n++){var r=[(t=e.results[n]).GAZETTEER_ENTRY.GEOMETRY_X,t.GAZETTEER_ENTRY.GEOMETRY_Y],s=d.latLng(proj4(c,"WGS84",r)),i=d.latLng(s.lng,s.lat),r=d.latLngBounds(i,i),s=t.GAZETTEER_ENTRY.NAME1+", ";t.GAZETTEER_ENTRY.DISTRICT_BOROUGH&&(s+=t.GAZETTEER_ENTRY.DISTRICT_BOROUGH+=", "),t.GAZETTEER_ENTRY.POPULATED_PLACE&&(s+=t.GAZETTEER_ENTRY.POPULATED_PLACE+=", "),t.GAZETTEER_ENTRY.COUNTY_UNITARY&&(s+=t.GAZETTEER_ENTRY.COUNTY_UNITARY+=", "),t.GAZETTEER_ENTRY.REGION&&(s+=t.GAZETTEER_ENTRY.REGION+=", "),t.GAZETTEER_ENTRY.COUNTRY&&(s+=t.GAZETTEER_ENTRY.COUNTRY),o[n]={name:s,bbox:r,center:i}}l.call(a,o)})}}),d.Control.Geocoder.ordnancesurvey=function(e){return new d.Control.Geocoder.OSOpenNames(e)},d.Control.Geocoder});
